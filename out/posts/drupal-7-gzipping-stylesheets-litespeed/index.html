<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
<link href='http://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!--[if lt IE 9]>
    <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
<![endif]-->


<title>Drupal 7: gzipping stylesheets on LiteSpeed | Data Informed E-Commerce UX</title>
<link rel="stylesheet" type="text/css" href="/css/style.css" />


<!-- Load HTML5 dependancies for IE -->
<!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
<!--[if lte IE 7]>
	<script src="js/IE8.js" type="text/javascript"></script><![endif]-->
<!--[if lt IE 7]>
	<link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/>
<![endif]-->

<meta name="description" content=""/>

<link rel="author" href="marco deseri"/>
<meta property='og:locale' content='en_US'/>
<meta property='og:type' content='website'/>
<meta property='og:title' content='Marco Deseri - Drupal 7: gzipping stylesheets on LiteSpeed'/>
<meta property='og:url' content='/posts/drupal-7-gzipping-stylesheets-litespeed'/>
<meta property='og:site_name' content='Marco Deseri'/>
<meta property='fb:admins' content='690861484'/>


<script type="text/javascript">//<![CDATA[
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-80445-6']);
	            _gaq.push(['_trackPageview']);
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
//]]></script>

<script type='text/javascript' src='/js/all.min.js'></script>


<script type='text/javascript'>
/* <![CDATA[ */
var thickboxL10n = {"next":"Next >","prev":"< Prev","image":"Image","of":"of","close":"Close","noiframes":"This feature requires inline frames. You have iframes disabled or your browser does not support them.","loadingAnimation":"\/images\/ui\/loadingAnimation.gif","closeImage":"/js\/thickbox\/tb-close.png"};
/* ]]> */
</script>


<link rel="text/stylesheeet" href="/ccs/all.min.css" />


<script type='text/javascript'>
window.___gcfg = {lang: 'en'};
(function() 
{var po = document.createElement('script');
po.type = 'text/javascript'; po.async = true;po.src = 'https://apis.google.com/js/plusone.js';
var s = document.getElementsByTagName('script')[0];
s.parentNode.insertBefore(po, s);
})();</script><style type='text/css' media='screen'>
	body{ font-family:"PT Serif", arial, sans-serif;}
</style>

</head>
<body class="home blog">

<div id="wrap" class="clearfix">

    <header id="masterhead" class="clearfix">
            <div id="logo">
                                    <a href="/" title="Marco Deseri">Marco Deseri</a>
                                
            </div>
            <!-- END logo -->
            
            <nav id="masternav" class="clearfix">
                <div class="menu-main-container">
                    <ul id="menu-main" class="sf-menu">
                    
                        
                            <li class="menu-item menu-item-type-post_type menu-item-object-page inactive">
                                <a href="/pages/blog">
                                    Blog
                                </a>
                            </li>
                        
                            <li class="menu-item menu-item-type-post_type menu-item-object-page inactive">
                                <a href="/pages/post">
                                    Resume
                                </a>
                            </li>
                        
                            <li class="menu-item menu-item-type-post_type menu-item-object-page inactive">
                                <a href="/pages/about">
                                    About Me
                                </a>
                            </li>
                        

                    </ul>
                </div>
            </nav>
            <!-- /masternav -->      
    </header><!-- /masterhead -->
    
<div id="main" class="clearfix">
<div class="home-wrap clearfix"> 
    <header id="page-heading">
        <h1>Blog</h1>	
    	<nav id="single-nav" class="clearfix"> 
        
            
        
                <!-- Get the current document, from there, we will be able to get the next and previous -->
                
            
        
                <!-- Get the current document, from there, we will be able to get the next and previous -->
                
            
        
                <!-- Get the current document, from there, we will be able to get the next and previous -->
                
            
        
                <!-- Get the current document, from there, we will be able to get the next and previous -->
                
            
        
                <!-- Get the current document, from there, we will be able to get the next and previous -->
                
            
        
                <!-- Get the current document, from there, we will be able to get the next and previous -->
                
             
                    <!-- We have the current document, do the next and previous buttons -->
                    
                    <!-- Check if we have a previous page -->
                    
                        <div id="single-nav-right"><a href="/posts/wireframing-balsamiq-mockups" class="previous">Older <span class="awesome-icon-chevron-right"></span></a></div>
                                          
                
            
        
                <!-- Get the current document, from there, we will be able to get the next and previous -->
                
            
        
                <!-- Get the current document, from there, we will be able to get the next and previous -->
                
            
        
        </nav>
        <!-- /single-nav -->	
    </header>
    
    
    <article class="post clearfix">
        <header>
    		<h1 class="single-title">Drupal 7: gzipping stylesheets on LiteSpeed | Data Informed E-Commerce UX</h1>
    		<div class="post-meta">
                <span class="awesome-icon-calendar"></span>On  Mon Feb 14 2011
                <span class="awesome-icon-user"></span>By <a href="/about" title="Posts by marco" rel="author">marco</a>            
                     
            </div>
    	</header>
    	<div class="entry clearfix">
    		<div class="field-item even">
    			If you care about Web Performance Optimization, you will love Drupal 7: its core takes care of both aggregating and compressing your css and js files.
<!--more-->
It's just a matter of enabling this option in the Configuration &gt; Performance section. Your site will load faster, serving gzipped files and reducing the number of http requests.

However, if you - like me - run your website on a LightSpeed webserver, you could be facing some issues. While css and js are successfully served gzipped and work fine on most browsers (safari, chrome, ie, opera), on Firefox you could see a completely unstyled page, throwing js errors at you.

Chances are your LightSpeed webserver is already gzipping css and js files for you, and your .htaccess forces that as well.

The problem is easily fixable; just head towards the end of your .htaccess and look for this block of code:
#Serve gzip compressed CSS files if they exist and the client accepts gzip.
RewriteCond %{HTTP:Accept-encoding} gzip RewriteCond %{REQUEST_FILENAME}\.gz -s
RewriteRule ^(.*)\.css $1\.css\.gz [QSA]
# Serve gzip compressed JS files if they exist and the client accepts gzip.
RewriteCond %{HTTP:Accept-encoding} gzip
RewriteCond %{REQUEST_FILENAME}\.gz -s
RewriteRule ^(.*)\.js $1\.js\.gz [QSA]
# Serve correct content types, and prevent mod_deflate double gzip.
RewriteRule \.css\.gz$ - [T=text/css,E=no-gzip:1]
RewriteRule \.js\.gz$ - [T=text/javascript,E=no-gzip:1]

# Serve correct encoding type.
Header append Content-Encoding gzip
# Force proxies to cache gzipped &amp; non-gzipped css/js files separately.
Header append Vary Accept-Encoding

Comment it and you're done ;)
If you are still having problems, check your css and js headers with Firebug and verify that files are being gzipped.

You can find other interesting ideas about this topic at Aggregate and compress CSS files" and "Aggregate JavaScript files" in performance settings, is not working on drupal.org.
    		</div>
    	
    	</div>	
    	<div class="clear"></div>
    </article>
    
    

    <aside id="sidebar" class="clearfix">
    <div class="sidebar-box clearfix">
		<h4><span>From Instagram</span></h4>
		<div id="flickrshow" style="height:240px;width:240px">Pictures from Flickr</div>
		<script type='text/javascript' src='/js/flickrshow-7.2.min.js'></script>
		<script type="text/javascript">
			var flickrShow = jQuery('#flickrshow').flickrshow({
			  autoplay:true,
			  interval:5000,
			  license:null,
			  page:1,
			  per_page:5,
			  hide_buttons: true,
			  tags:'instagram',
			  user:'31978899@N00'
			});
		</script>
		<div style="clear:both"></div>
	</div>


	<div class="sidebar-box clearfix">
		<h4><span>Last Tweets</span></h4>
		<a class="twitter-timeline" href="https://twitter.com/marcodeseri" data-widget-id="349983210345742336" data-chrome="nofooter noborders transparent" data-tweet-limit="3" width="240">@hey</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

	</div>
</aside>
 
    
TypeError: Cannot call method 'toJSON' of undefined 